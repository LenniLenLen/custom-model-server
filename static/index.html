<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Models</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;}
ul{list-style:none;padding:0;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;}
li{border:1px solid #ddd;padding:6px;border-radius:6px;display:flex;flex-direction:column;align-items:center;}
img.thumb{width:100px;height:100px;object-fit:contain;background:#eee;}
button{padding:4px 6px;margin-top:4px;cursor:pointer;}
.loading{background:#f0f0f0 url('data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwv///yH5BAAAAAAALAAAAAAQABAAAANRaLrc/jDKSau9OOvNu/9gKI5ikCQA7') center center no-repeat;}
</style>
</head>
<body>
<h1>Models</h1>

<form id="uploadForm">
  <input type="text" id="modelName" placeholder="Model name" required/>
  <input type="file" id="modelFile" accept=".zip,.json,.obj,.gltf,.glb,.fbx" required/>
  <button type="submit">Upload</button>
</form>

<ul id="list"></ul>

<script>
const list = document.getElementById('list');
async function refresh(){
  list.innerHTML='';
  const res = await fetch('/models');
  const models = await res.json();
  for(const m of models){
    const li=document.createElement('li');
    const img=document.createElement('img');
    img.className='thumb loading';
    img.alt=m;
    img.src=`/preview/${encodeURIComponent(m)}`;
    img.onload=()=>img.classList.remove('loading');
    img.onerror=()=>{ img.src=''; img.classList.remove('loading'); };
    li.appendChild(img);

    const name=document.createElement('div'); name.textContent=m;
    li.appendChild(name);

    const del=document.createElement('button'); del.textContent='Delete';
    del.onclick=async()=>{ await fetch(`/models/${encodeURIComponent(m)}`,{method:'DELETE'}); refresh(); };
    li.appendChild(del);

    list.appendChild(li);
  }
}

document.getElementById('uploadForm').onsubmit=async e=>{
  e.preventDefault();
  const name=document.getElementById('modelName').value.trim();
  const file=document.getElementById('modelFile').files[0];
  if(!name||!file)return alert('Name + file required');
  const fd=new FormData(); fd.append('modelName',name); fd.append('file',file);
  const resp=await fetch('/upload',{method:'POST',body:fd});
  if(!resp.ok){ alert('Upload failed'); return; }
  document.getElementById('uploadForm').reset();
  refresh();
};

refresh();
</script>
</body>
</html>
