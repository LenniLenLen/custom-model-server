<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Custom Model Uploader</title>
<style>
  body{ font-family:Arial,sans-serif;margin:20px;max-width:900px;}
  header{display:flex;align-items:center;gap:1rem;margin-bottom:1rem;}
  form{display:flex;gap:0.5rem;align-items:center;flex-wrap:wrap;margin-bottom:1rem;}
  input[type=text]{padding:8px;border:1px solid #ccc;border-radius:4px;}
  input[type=file]{padding:6px;}
  button{padding:8px 12px;border-radius:6px;border:0;background:#0066ff;color:#fff;cursor:pointer;}
  ul{list-style:none;padding:0;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;}
  li{background:#fafafa;border:1px solid #eee;padding:10px;border-radius:8px;display:flex;gap:10px;align-items:center;}
  img.thumb{width:72px;height:72px;object-fit:contain;background:#fff;border:1px solid #ddd;}
  .meta{flex:1;}
  .meta b{display:block;margin-bottom:6px;}
  .actions{display:flex;gap:8px;}
  .danger{background:#e74c3c;}
</style>
</head>
<body>
<header>
  <h1>Models</h1>
  <div style="margin-left:auto">Server pack: <a href="/pack.zip">pack.zip</a></div>
</header>

<form id="uploadForm">
  <input type="text" id="modelName" placeholder="Model name (unique)" required>
  <input type="file" id="modelFile" accept=".zip,.json,.obj,.gltf,.glb,.fbx" required>
  <input type="file" id="thumbFile" accept=".png">
  <button type="submit">Upload</button>
</form>

<h2>All Models</h2>
<ul id="modelList"></ul>

<script>
  const form=document.getElementById('uploadForm');
  const list=document.getElementById('modelList');

  async function refreshList(){
    const res=await fetch('/models');
    const folders=await res.json();
    list.innerHTML='';
    folders.forEach(folder=>{
      const li=document.createElement('li');
      const img=document.createElement('img');
      img.className='thumb';
      img.alt=folder;
      img.src='/preview/'+encodeURIComponent(folder);
      img.onerror=()=>{img.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="72" height="72"><rect width="100%" height="100%" fill="#f5f5f5"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-size="10">loading...</text></svg>';};

      const meta=document.createElement('div'); meta.className='meta';
      const title=document.createElement('b'); title.textContent=folder; meta.appendChild(title);

      const actions=document.createElement('div'); actions.className='actions';
      const delBtn=document.createElement('button'); delBtn.textContent='Delete'; delBtn.className='danger';
      delBtn.onclick=async()=>{if(confirm(`Delete "${folder}"?`)){await fetch(`/models/${encodeURIComponent(folder)}`,{method:'DELETE'}); refreshList();}};
      actions.appendChild(delBtn);

      li.appendChild(img); li.appendChild(meta); li.appendChild(actions);
      list.appendChild(li);
    });
  }

  form.onsubmit=async e=>{
    e.preventDefault();
    const name=document.getElementById('modelName').value.trim();
    const file=document.getElementById('modelFile').files[0];
    const thumb=document.getElementById('thumbFile').files[0];
    if(!name||!file) return alert('Model name and file required');
    const fd=new FormData();
    fd.append('modelName',name);
    fd.append('file',file);
    if(thumb) fd.append('thumbnail',thumb);
    const resp=await fetch('/upload',{method:'POST',body:fd});
    if(!resp.ok){alert('Upload failed'); return;}
    form.reset(); refreshList();
  };

  refreshList();
</script>
</body>
</html>
