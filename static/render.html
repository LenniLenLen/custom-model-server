<!doctype html>
<html>
<head><meta charset="utf-8"><title>Render</title>
<style>body,html{margin:0;padding:0;} canvas{display:block;}</style>
</head>
<body>
<div id="container"></div>
<script src="https://unpkg.com/three@0.162.0/build/three.min.js"></script>
<script src="https://unpkg.com/prismarine-viewer@latest/dist/prismarine-viewer.min.js"></script>
<script>
(async()=>{
  const modelName=decodeURIComponent(location.pathname.split('/').pop());
  const container=document.getElementById('container');
  const viewer=PrismarineViewer.createViewer(container,{width:512,height:512,zoom:2.5,background:0x00000000});
  const three=viewer.THREE;
  const scene=viewer.scene;

  // find model file (.obj/.gltf/.glb/.fbx)
  async function exists(url){ try{ const r=await fetch(url,{method:'HEAD'}); return r.ok;}catch(e){return false;} }
  const exts=['.json','.obj','.gltf','.glb','.fbx'];
  let modelUrl=null;
  for(const ext of exts){
    const u=`/model-file/${encodeURIComponent(modelName)}/${modelName}${ext}`;
    if(await exists(u)){ modelUrl=u; break; }
  }

  if(!modelUrl){ // placeholder cube
    const cube=new three.Mesh(new three.BoxGeometry(1,1,1), new three.MeshNormalMaterial());
    scene.add(cube);
    viewer.camera.position.set(1.2,1.2,2.5);
    viewer.camera.lookAt(0,0,0);
    window.__THUMB_READY=true; return;
  }

  // otherwise render a simple textured plane for preview
  const texUrl=`/model-file/${encodeURIComponent(modelName)}/${modelName}.png`;
  let material;
  try{
    const loader=new three.TextureLoader(); const tex=await new Promise(r=>loader.load(tex,r,null,()=>r(null)));
    material=tex?new three.MeshBasicMaterial({map:tex,transparent:true}):new three.MeshNormalMaterial();
  }catch(e){ material=new three.MeshNormalMaterial(); }
  const mesh=new three.Mesh(new three.BoxGeometry(1,1,1),material);
  scene.add(mesh);
  viewer.camera.position.set(1.2,1.2,2.5);
  viewer.camera.lookAt(0,0,0);
  window.__THUMB_READY=true;
})();
</script>
</body>
</html>
